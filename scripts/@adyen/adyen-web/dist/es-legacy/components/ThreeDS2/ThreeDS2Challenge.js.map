{"version":3,"file":"ThreeDS2Challenge.js","sources":["../../../../src/components/ThreeDS2/ThreeDS2Challenge.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport PrepareChallenge from './components/Challenge';\nimport { DEFAULT_CHALLENGE_WINDOW_SIZE, THREEDS2_CHALLENGE, THREEDS2_CHALLENGE_ERROR, THREEDS2_FULL } from './constants';\nimport { existy } from '../../utils/commonUtils';\nimport { hasOwnProperty } from '../../utils/hasOwnProperty';\nimport { TxVariants } from '../tx-variants';\nimport { ThreeDS2ChallengeConfiguration } from './types';\nimport AdyenCheckoutError, { API_ERROR } from '../../core/Errors/AdyenCheckoutError';\nimport { ANALYTICS_ERROR_TYPE, Analytics3DS2Errors, ANALYTICS_RENDERED_STR, Analytics3DS2Events } from '../../core/Analytics/constants';\nimport { CoreProvider } from '../../core/Context/CoreProvider';\nimport { ActionHandledReturnObject } from '../../types/global-types';\nimport { AnalyticsLogEvent } from '../../core/Analytics/AnalyticsLogEvent';\nimport { AnalyticsEvent } from '../../core/Analytics/AnalyticsEvent';\nimport { AnalyticsInfoEvent } from '../../core/Analytics/AnalyticsInfoEvent';\nimport { AnalyticsErrorEvent } from '../../core/Analytics/AnalyticsErrorEvent';\n\nclass ThreeDS2Challenge extends UIElement<ThreeDS2ChallengeConfiguration> {\n    public static type = TxVariants.threeDS2Challenge;\n\n    public static defaultProps = {\n        dataKey: 'threeDSResult',\n        size: DEFAULT_CHALLENGE_WINDOW_SIZE,\n        type: THREEDS2_CHALLENGE\n    };\n\n    protected submitAnalytics = (aObj: AnalyticsEvent) => {\n        if (aObj instanceof AnalyticsInfoEvent && aObj.type === ANALYTICS_RENDERED_STR) return; // suppress the rendered event (it will have the same timestamp as the \"creq sent\" event)\n\n        super.submitAnalytics(aObj);\n    };\n\n    protected onActionHandled = (rtnObj: ActionHandledReturnObject) => {\n        const event = new AnalyticsLogEvent({\n            type: THREEDS2_FULL,\n            message: rtnObj.actionDescription,\n            subType: Analytics3DS2Events.CHALLENGE_IFRAME_LOADED\n        });\n\n        this.submitAnalytics(event);\n\n        super.onActionHandled(rtnObj);\n    };\n\n    onComplete(state) {\n        /**\n         * Equals a call to onAdditionalDetails (as set in actionTypes.ts) for the regular, \"native\" flow.\n         * However, if the action to create this component came from the 3DS2InMDFlow process it will instead equal a call to the onComplete callback\n         * (as defined in the 3DS2InMDFlow and passed in as a config prop).\n         */\n        if (state) super.onComplete(state);\n        this.unmount(); // re. fixing issue around back to back challenge calls\n    }\n\n    render() {\n        // existy used because threeds2InMDFlow will send empty string for paymentData and we should be allowed to proceed with this\n        if (!existy(this.props.paymentData)) {\n            /**\n             *   The presence of props.isMDFlow indicates the action to create this component came from the threeds2InMDFlow process which passes (an empty) paymentsData.\n             *   The regular, \"native\" flow uses the authorisationToken from the 3DS2 action, which actionTypes.ts assigns to a property called paymentData\n             */\n            const dataTypeForError = hasOwnProperty(this.props, 'isMDFlow') ? 'paymentData' : 'authorisationToken';\n\n            this.props.onError(new AdyenCheckoutError(API_ERROR, `No ${dataTypeForError} received. 3DS2 Challenge cannot proceed`));\n\n            const event = new AnalyticsErrorEvent({\n                code: Analytics3DS2Errors.ACTION_IS_MISSING_PAYMENT_DATA,\n                errorType: ANALYTICS_ERROR_TYPE.apiError,\n                message: `${THREEDS2_CHALLENGE_ERROR}: Missing 'paymentData' property from threeDS2 action`\n            });\n\n            this.submitAnalytics(event);\n\n            return null;\n        }\n\n        return (\n            <CoreProvider i18n={this.props.i18n} loadingContext={this.props.loadingContext} resources={this.resources}>\n                <PrepareChallenge\n                    {...this.props}\n                    onComplete={this.onComplete}\n                    onSubmitAnalytics={this.submitAnalytics}\n                    isMDFlow={this.props.paymentData.length < 15}\n                    onActionHandled={this.onActionHandled}\n                />\n            </CoreProvider>\n        );\n    }\n}\n\nexport default ThreeDS2Challenge;\n"],"names":["ThreeDS2Challenge","UIElement","onComplete","state","super","this","unmount","render","existy","props","paymentData","dataTypeForError","hasOwnProperty","onError","AdyenCheckoutError","API_ERROR","event","AnalyticsErrorEvent","code","Analytics3DS2Errors","ACTION_IS_MISSING_PAYMENT_DATA","errorType","ANALYTICS_ERROR_TYPE","apiError","message","THREEDS2_CHALLENGE_ERROR","submitAnalytics","h","CoreProvider","i18n","loadingContext","resources","PrepareChallenge","onSubmitAnalytics","isMDFlow","length","onActionHandled","args","_define_property","aObj","AnalyticsInfoEvent","type","ANALYTICS_RENDERED_STR","rtnObj","AnalyticsLogEvent","THREEDS2_FULL","actionDescription","subType","Analytics3DS2Events","CHALLENGE_IFRAME_LOADED","TxVariants","threeDS2Challenge","defaultProps","dataKey","size","DEFAULT_CHALLENGE_WINDOW_SIZE","THREEDS2_CHALLENGE"],"mappings":"m+CAiBA,MAAMA,UAA0BC,EA2B5BC,UAAAA,CAAWC,GAMHA,GAAOC,MAAMF,WAAWC,GAC5BE,KAAKC,SACT,CAEAC,MAAAA,GAEI,IAAKC,EAAOH,KAAKI,MAAMC,aAAc,CAKjC,MAAMC,EAAmBC,EAAeP,KAAKI,MAAO,YAAc,cAAgB,qBAElFJ,KAAKI,MAAMI,QAAQ,IAAIC,EAAmBC,EAAW,MAAMJ,8CAE3D,MAAMK,EAAQ,IAAIC,EAAoB,CAClCC,KAAMC,EAAoBC,+BAC1BC,UAAWC,EAAqBC,SAChCC,QAAS,GAAGC,2DAKhB,OAFApB,KAAKqB,gBAAgBV,GAEd,IACX,CAEA,OACIW,EAACC,EAAAA,CAAaC,KAAMxB,KAAKI,MAAMoB,KAAMC,eAAgBzB,KAAKI,MAAMqB,eAAgBC,UAAW1B,KAAK0B,WAC5FJ,EAACK,EAAAA,wUAAAA,CAAAA,GACO3B,KAAKI,OAAK,CACdP,WAAYG,KAAKH,WACjB+B,kBAAmB5B,KAAKqB,gBACxBQ,SAAU7B,KAAKI,MAAMC,YAAYyB,OAAS,GAC1CC,gBAAiB/B,KAAK+B,mBAItC,mBAtEJhC,SASIiC,GAAAC,EAAAjC,KAAUqB,mBAAmBa,IACrBA,aAAgBC,GAAsBD,EAAKE,OAASC,GAExDtC,MAAMsB,gBAAgBa,EAAAA,IAG1BD,EAAAjC,KAAU+B,mBAAmBO,IACzB,MAAM3B,EAAQ,IAAI4B,EAAkB,CAChCH,KAAMI,EACNrB,QAASmB,EAAOG,kBAChBC,QAASC,EAAoBC,0BAGjC5C,KAAKqB,gBAAgBV,GAErBZ,MAAMgC,gBAAgBO,EAAAA,KAvB1BL,EADEtC,EACYyC,OAAOS,EAAWC,mBAEhCb,EAHEtC,EAGYoD,eAAe,CACzBC,QAAS,gBACTC,KAAMC,EACNd,KAAMe"}